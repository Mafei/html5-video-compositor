<!DOCTYPE html>
<html>
<head>
    <title>BBC R&ampD Video Compositor</title>
</head>
<body>
    <script type="text/javascript" src="../dist/videocompositor.js"></script>
    <script type="text/javascript">
        window.onload = function () {

            /*
            *
            * Set up the video compositor 
            *
            */

            var canvas = document.getElementById('player-canvas');
            canvas.width = 800;
            canvas.height = 420;

            var videoCompositor = new VideoCompositor(canvas);

            var playlist = {
                "tracks":[
                    [{type:"image", start:0, duration:15, src:"assets/plate.png", id:"5"}],
                    [{type:"video", sourceStart:0, start:0, duration:5, src:"assets/video1.mp4", id:"1"},                 {type:"video", sourceStart:10, start:7.5,src:"assets/video1.mp4", duration:5, id:"3"}],
                    [                                 {type:"image", start:2.5, duration:5, src:"assets/image.jpg", id:"2"},                                {type:"image", start:10, duration:5, src:"assets/image.jpg", id:"4"}]
                ]
            };

            var duration = VideoCompositor.calculatePlaylistDuration(playlist);
            console.log("Playlist Duration", duration);
            videoCompositor.playlist = playlist;
            videoCompositor.play();



            /*
            *
            * Create an interactive visualisation canvas.
            *
            */
            var visualisationCanvas = document.getElementById("visualisation-canvas");
            visualisationCanvas.height = 20;
            visualisationCanvas.width = 800;
            //Setup up a render function so we can update the playhead position.
            function render () {
                VideoCompositor.renderPlaylist(playlist, visualisationCanvas, videoCompositor.currentTime);            
                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
            //catch mouse events to we can scrub through the timeline.
            visualisationCanvas.addEventListener("mousedown", function(evt){
                var x;
                if (evt.x!= undefined){
                    x = evt.x - visualisationCanvas.offsetLeft;
                }else{
                    //Fix for firefox
                    x = evt.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;          
                }

                var secondsPerPixel = videoCompositor.duration / visualisationCanvas.width;
                videoCompositor.currentTime = secondsPerPixel*x;
            }, false);


        };
    </script>
    <canvas id="player-canvas"></canvas>
    <br>
    <canvas id="visualisation-canvas"></canvas>
</body>
</html>